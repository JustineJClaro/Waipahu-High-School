<!DOCTYPE html>
<html lang="en">

<head>
  <title>Waipahu HS Bulletin</title>
  meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="styles.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

  <!-- Bootstrap JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

  <!-- Custom JS -->
  <script src="../index.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="styles.css">

  <style>
    .accordion-button::after {
      transition: transform 0.2s ease-in-out;
    }
    .accordion-button.collapsed::after {
      transform: rotate(0deg);
    }
  </style>
</head>

<body>
  <div class="container-fluid p-4 bg-primary text-white text-center">
    <h1>Waipahu High School</h1>
  </div>

  <main class="container mt-4">
    <h2 class="text-center">News and Announcements</h2>
    <h2 id="todayDate" class="text-center mb-4"></h2>

    <h3>ðŸ“¢ School Announcements</h3>
    <div class="accordion" id="notifications">
      <div class="text-center my-4">
        <div class="spinner-border" role="status"></div>
      </div>
    </div>

    <script>
      async function loadGoogleDoc() {
        const accordion = document.getElementById('notifications');
        accordion.innerHTML = '<div class="text-center my-4"><div class="spinner-border" role="status"></div></div>';

        try {
          const response = await fetch('https://api.allorigins.win/raw?url=https://docs.google.com/document/d/e/2PACX-1vSBGOtfDF_UpFHYH1iBlzBGdUODeeMWT97IPv4aFsWw_W4eyjollFtvN0yRe7FXj62h-agAppMkKPA0/pub');
          const html = await response.text();

          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');

          const body = doc.body;
          const allParagraphs = body.querySelectorAll('p');
          const maxItems = 5;
          let count = 0;

          accordion.innerHTML = '';

          for (let i = 0; i < allParagraphs.length; i++) {
            if (count >= maxItems) break;

            const p = allParagraphs[i];
            const text = p.textContent.trim();

            if (text.length < 10 || text.length > 1500) continue;
            if (!/[a-zA-Z]/.test(text)) continue;

            const item = document.createElement('div');
            item.className = 'accordion-item';
            item.innerHTML = `
              <h2 class="accordion-header" id="heading${count}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapse${count}" aria-expanded="false" aria-controls="collapse${count}">
                  Notification ${count + 1}
                </button>
              </h2>
              <div id="collapse${count}" class="accordion-collapse collapse" aria-labelledby="heading${count}">
                <div class="accordion-body">${text.replace(/\n/g, '<br>')}</div>
              </div>
            `;
            accordion.appendChild(item);
            count++;
          }

          if (count === 0) {
            accordion.innerHTML = '<div class="alert alert-warning">No announcements found.</div>';
          }

        } catch (error) {
          accordion.innerHTML = '<div class="alert alert-danger">Failed to load announcements.</div>';
          console.error('Error loading doc:', error);
        }
      }

      loadGoogleDoc();
    </script>

    <hr>

    <!-- Today's Schedule -->
    <div class="panel-group border rounded p-3">
      <h4><strong>Today's Schedule</strong></h4>
      <h5 id="today" class="text-primary mb-2"></h5>
      <iframe src="https://www.waipahuhigh.org/STUDENTBELLSCHEDULE2023-2024.pdf"
        width="100%" height="600px" type="application/pdf"></iframe>
    </div>

    <hr>

    <!-- Announcement Card -->
    <div class="container mt-4">
      <img src="https://www.waipahuhigh.org/ourpages/auto/2025/4/1/45166328/class%20of%202026%20junior%20year%20-%20family%20night%20instagram%20post%20color_thumb.jpg?1743528916000"
        alt="Image preview" height="75">
      <br>
      <a href="https://www.waipahuhigh.org/apps/news/show_news.jsp?REC_ID=960390&id=0">Class of 2026 Junior Year - Family Night</a>
      <p>
        Wednesday, April 23, 2025 â€” 5:30 PM Check-In & Dinner, 6:00 PM Program Begins. <br>
        The College Center will be hosting a C/O 2026 Junior Year Family Night on Wednesday, April 23rd, at 6:00 PM in the school cafeteria. <br>
        Pacific University Oregon Associate Director, Donna Ramos Barsana, will share tips on applying to colleges. <br>
        RSVP: <a href="https://tinyurl.com/26springfamilynight">tinyurl.com/26springfamilynight</a>
      </p>
    </div>
  </main>

  <script>
    // Display today's date and schedule
    const d = new Date();
    document.getElementById("todayDate").textContent = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;

    const day = d.getDay();
    const schedule = ["NO SCHOOL", "MONDAY SCHEDULE", "TUESDAY SCHEDULE", "WEDNESDAY SCHEDULE", "THURSDAY SCHEDULE", "FRIDAY SCHEDULE", "NO SCHOOL"];
    document.getElementById("today").textContent = schedule[day];
  </script>
</body>
</html>
